<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Candidates!</title>
  <style>
    :root {
      --primary: #1eaf61;
      --primary-dark: #168c4e;
      --primary-light: #55d08f;
      --text: #163b2e;
      --bg: linear-gradient(135deg, #f6fbf6 0%, #e9f7ee 100%);
      --card-bg: #ffffff;
      --shadow: rgba(16, 88, 45, 0.06);
      --shadow-hover: rgba(30, 175, 97, 0.12);
      --border-radius: 16px;
      --note-bg: linear-gradient(135deg, #eaf9ec 0%, #cff2d9 100%);
      --candidate-card-bg: #ffffff;
      --candidate-card-hover: #f7fff9;
      --empty-state-color: #52786a;
      --border-color: #e6f0ea;
      --accent: #1eaf61;
      --success: #2ecc71;
      --warning: #f39c12;
      --focus: rgba(30, 175, 97, 0.18);
    }

    [data-theme="dark"] {
      --primary: #54d88f;
      --primary-dark: #2ea86a;
      --primary-light: #8de6b3;
      --text: #e6f6ea;
      --bg: linear-gradient(135deg, #07160d 0%, #0f2418 100%);
      --card-bg: #0f2a1c;
      --shadow: rgba(0, 0, 0, 0.45);
      --shadow-hover: rgba(30, 175, 97, 0.12);
      --note-bg: linear-gradient(135deg, #0e3926 0%, #144e33 100%);
      --candidate-card-bg: #123424;
      --candidate-card-hover: #15472f;
      --empty-state-color: #93d8b0;
      --border-color: #143a28;
      --accent: #8ee0b2;
      --focus: rgba(80, 200, 140, 0.12);
    }

    * {
      box-sizing: border-box;
      transition: background-color 0.25s ease, color 0.25s ease, border-color 0.25s ease,
        transform 0.15s ease;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue",
        Arial;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      color: var(--text);
      background: var(--bg);
      line-height: 1.5;
    }

    /* Header */
    .page-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 16px 22px;
      position: sticky;
      top: 0;
      z-index: 1200;
      display: flex;
      align-items: center;
      gap: 16px;
      justify-content: space-between;
      box-shadow: 0 6px 26px var(--shadow);
      border-bottom: 1px solid rgba(255, 255, 255, 0.07);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .back-btn {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 10px 16px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      text-decoration: none;
      font-weight: 700;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .header-title {
      font-weight: 800;
      font-size: 1.15rem;
      margin-left: 6px;
      letter-spacing: -0.02em;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .theme-toggle {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255, 255, 255, 0.12);
      cursor: pointer;
      font-size: 18px;
    }

    /* Note */
    .note {
      max-width: 1200px;
      margin: 20px auto;
      padding: 16px 20px;
      background: var(--note-bg);
      border-radius: 12px;
      color: var(--text);
      font-weight: 600;
      box-shadow: 0 10px 28px var(--shadow);
      border: 1px solid var(--border-color);
    }

    /* Main container */
    .candidates-container {
      max-width: 1200px;
      margin: 20px auto 64px;
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 20px 60px var(--shadow);
      padding: 28px;
      border: 1px solid var(--border-color);
    }

    .candidates-header {
      display: flex;
      gap: 18px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 22px;
    }

    .title {
      font-size: clamp(1.4rem, 2.6vw, 2rem);
      margin: 0;
      font-weight: 800;
      background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* Search + Filters */
    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .search {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(0, 0, 0, 0.03);
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      min-width: 220px;
    }

    .search input {
      border: none;
      background: transparent;
      outline: none;
      font-size: 0.95rem;
      color: var(--text);
      width: 220px;
    }

    .select {
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      background: transparent;
      color: var(--text);
      font-weight: 600;
    }

    .reset-btn {
      padding: 8px 12px;
      border-radius: 10px;
      background: linear-gradient(90deg, rgba(0, 0, 0, 0.04), transparent);
      border: 1px solid var(--border-color);
      cursor: pointer;
      font-weight: 700;
    }

    /* Position block */
    .position-block {
      margin-bottom: 36px;
    }

    .position-block h3 {
      color: var(--primary-dark);
      font-size: 1.1rem;
      margin: 0 0 18px 0;
      font-weight: 800;
    }

    /* Candidate grid */
    .candidate-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 18px;
    }

    .candidate-card {
      background: var(--candidate-card-bg);
      border-radius: 14px;
      padding: 18px;
      display: flex;
      gap: 14px;
      align-items: center;
      border: 1px solid transparent;
      box-shadow: 0 12px 30px var(--shadow);
      text-decoration: none;
      color: inherit;
      position: relative;
      overflow: hidden;
    }

    .candidate-card:focus-visible {
      outline: none;
      box-shadow: 0 6px 24px var(--shadow), 0 0 0 4px var(--focus);
      border-color: rgba(30, 175, 97, 0.12);
    }

    .candidate-avatar {
      width: 84px;
      height: 84px;
      border-radius: 50%;
      flex-shrink: 0;
      border: 4px solid var(--primary);
      display: grid;
      place-items: center;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.2));
    }

    .candidate-avatar img {
      width: 76px;
      height: 76px;
      border-radius: 50%;
      object-fit: cover;
    }

    .candidate-body {
      flex: 1;
      min-width: 0;
    }

    .candidate-name {
      font-weight: 800;
      font-size: 1.05rem;
      margin-bottom: 6px;
      color: var(--text);
    }

    .candidate-role {
      font-size: 0.92rem;
      color: var(--empty-state-color);
    }

    .candidate-meta {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(30, 175, 97, 0.12), rgba(30, 175, 97, 0.04));
      color: var(--primary-dark);
      font-weight: 700;
      font-size: 0.82rem;
      border: 1px solid rgba(30, 175, 97, 0.08);
    }

    .view-btn {
      padding: 8px 12px;
      border-radius: 10px;
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      color: white;
      font-weight: 800;
      border: none;
      cursor: pointer;
      text-decoration: none;
    }

    .candidate-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 30px 70px var(--shadow-hover);
      background: var(--candidate-card-hover);
      border-color: rgba(30, 175, 97, 0.08);
    }

    .empty-state {
      text-align: center;
      padding: 36px 22px;
      color: var(--empty-state-color);
      background: linear-gradient(135deg, rgba(30, 175, 97, 0.03), rgba(30, 175, 97, 0.01));
      border-radius: 12px;
      border: 1px dashed var(--border-color);
    }

    /* Placeholder avatar inline SVG */
    .avatar-placeholder svg {
      width: 56px;
      height: 56px;
    }

    /* Responsive */
    @media (max-width: 720px) {
      .candidate-list {
        grid-template-columns: 1fr;
      }

      .search input {
        width: 120px;
      }

      .candidate-avatar {
        width: 72px;
        height: 72px;
      }

      .candidate-avatar img {
        width: 64px;
        height: 64px;
      }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * {
        transition: none !important;
      }

      .candidate-card {
        transform: none !important;
      }
    }
  </style>
</head>

<body>
  <header class="page-header">
    <div class="header-left">
      <a href="{{ url_for('dashboard') }}" class="back-btn" aria-label="Back to dashboard">
        <span>‚Üê</span>
        <span>Back to Department Dashboard</span>
      </a>
    </div>

    <div class="header-actions">
      <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
        <span class="theme-icon">üåô</span>
      </button>
    </div>
  </header>

  <div class="note" role="note" aria-live="polite">
    <strong>Note:</strong> Click a candidate to view their profile and campaign details. Use search to quickly
    find a candidate.
  </div>

  <main class="candidates-container">
    <div class="candidates-header">
      <h1 class="title">Candidates for {{ department }}</h1>

      <div class="controls" role="region" aria-label="Search and filters">
        <label class="search" for="searchInput">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
              stroke-linejoin="round"></path>
            <circle cx="11" cy="11" r="6.5" stroke="currentColor" stroke-width="1.6"></circle>
          </svg>
          <input id="searchInput" type="search" placeholder="Search candidate name..." aria-label="Search candidates" />
        </label>
      </div>
    </div>

    {% if positions_with_candidates|length == 0 %}
    <div class="empty-state" role="status">
      <p>No positions found for your department.</p>
      <p>Please check back later when candidates are available.</p>
    </div>
    {% else %}

    <!-- Iterate positions -->
    {% for pos_block in positions_with_candidates %}
    <section class="position-block" aria-labelledby="pos-{{ pos_block.position.id }}">
      <h3 id="pos-{{ pos_block.position.id }}">{{ pos_block.position.name }}</h3>

      <div class="candidate-list" role="list">
        {% if pos_block.candidates|length == 0 %}
        <div class="empty-state">
          <p>No candidates for this position yet.</p>
        </div>
        {% else %}
        {% for cand in pos_block.candidates %}
        <a href="{{ url_for('candidate_details', id=cand.id) }}" class="candidate-card" role="listitem"
          data-name="{{ cand.name | lower }}" data-position="{{ pos_block.position.name | lower }}" tabindex="0"
          aria-label="View profile for {{ cand.name }}">
          <div class="candidate-avatar" aria-hidden="true">
            {% if cand.image %}
            <img src="{{ url_for('static', filename=cand.image) }}" alt="{{ cand.name }}">
            {% else %}
            <div class="avatar-placeholder" aria-hidden="true">
              <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" role="img" focusable="false">
                <rect width="100" height="100" rx="50" fill="#e6f6ea"></rect>
                <g fill="#79cfa0">
                  <circle cx="50" cy="36" r="18"></circle>
                  <path d="M26 78c6-12 18-18 24-18s18 6 24 18" fill="#79cfa0"></path>
                </g>
              </svg>
            </div>
            {% endif %}
          </div>

          <div class="candidate-body">
            <div class="candidate-name">{{ cand.name }}</div>
            <div class="candidate-role">{{ pos_block.position.name }}</div>

            <div class="candidate-meta" aria-hidden="true">
              <div class="badge">Click to view</div>
              {% if cand.party %}
              <div class="badge">{{ cand.party }}</div>
              {% endif %}
            </div>
          </div>


        </a>
        {% endfor %}
        {% endif %}
      </div>
    </section>
    {% endfor %}

    {% endif %}
  </main>

  <script>
    // Theme manager
    class ThemeManager {
      constructor() {
        this.theme = localStorage.getItem('theme') || 'light';
        this.userChoiceKey = 'theme-user-choice';
        this.init();
      }

      init() {
        if (!localStorage.getItem('theme')) {
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          this.theme = prefersDark ? 'dark' : 'light';
        } else {
          this.theme = localStorage.getItem('theme');
        }
        this.applyTheme();
        this.bind();
      }

      applyTheme() {
        document.documentElement.setAttribute('data-theme', this.theme);
        localStorage.setItem('theme', this.theme);
        const icon = document.querySelector('.theme-icon');
        if (icon) icon.textContent = this.theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
      }

      toggle() {
        this.theme = this.theme === 'light' ? 'dark' : 'light';
        localStorage.setItem(this.userChoiceKey, 'true');
        this.applyTheme();
        const el = document.getElementById('themeToggle');
        if (el) {
          el.animate([{transform: 'scale(0.92)'}, {transform: 'scale(1)'}], {duration: 220});
        }
      }

      bind() {
        const toggle = document.getElementById('themeToggle');
        if (toggle) toggle.addEventListener('click', () => this.toggle());

        // Respect system changes when user hasn't chosen explicitly
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
          if (!localStorage.getItem(this.userChoiceKey)) {
            this.theme = e.matches ? 'dark' : 'light';
            this.applyTheme();
          }
        });
      }
    }

    // Simple client-side filter for candidates
    class CandidateFilter {
      constructor() {
        this.searchInput = document.getElementById('searchInput');
        this.positionSelect = document.getElementById('positionFilter');
        this.resetBtn = document.getElementById('resetFilters');
        this.candidateCards = Array.from(document.querySelectorAll('.candidate-card'));
        this.bind();
      }

      bind() {
        if (this.searchInput) {
          this.searchInput.addEventListener('input', () => this.filter());
        }
        if (this.positionSelect) {
          this.positionSelect.addEventListener('change', () => this.filter());
        }
        if (this.resetBtn) {
          this.resetBtn.addEventListener('click', () => this.reset());
        }

        // Make each candidate card accessible with Enter to follow link
        this.candidateCards.forEach(card => {
          card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
              card.click();
            }
          });
        });
      }

      normalize(text) {
        return (text || '').toString().trim().toLowerCase();
      }

      filter() {
        const q = this.normalize(this.searchInput ? this.searchInput.value : '');
        const pos = this.normalize(this.positionSelect ? this.positionSelect.value : 'all');

        this.candidateCards.forEach(card => {
          const name = card.getAttribute('data-name') || '';
          const position = card.getAttribute('data-position') || '';

          const matchesQuery = !q || name.indexOf(q) !== -1;
          const matchesPosition = pos === 'all' || position === pos;

          if (matchesQuery && matchesPosition) {
            card.style.display = '';
          } else {
            card.style.display = 'none';
          }
        });
      }

      reset() {
        if (this.searchInput) this.searchInput.value = '';
        if (this.positionSelect) this.positionSelect.value = 'all';
        this.filter();
        if (this.searchInput) this.searchInput.focus();
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      new ThemeManager();
      new CandidateFilter();
    });
  </script>
</body>

</html>